<!DOCTYPE html>
<html>

    <head>
        <title>10 Sekunden Schnipsel mit 5 Sekunden Ãœberlagerung</title>
        <script type="module">

            let isRunning = false
            let audioStream

            // Button zum Starten und Stoppen
            const startStopButton = document.getElementById('startStopButton')
            startStopButton.addEventListener('click', async () => {
                if (isRunning) {
                    await stop()
                    startStopButton.innerHTML = 'Start'
                    isRunning = false
                } else {
                    const startSucceeded = await start()
                    if (startSucceeded) {
                        startStopButton.innerHTML = 'Stop'
                        isRunning = true
                    }
                }
            })

            // Fragt nach Mikrofonberechtigung und beginnt Aufnahme und Verarbeitung
            async function start() {
                // Berechtigung wird automatisch abgefragt
                try {
                    audioStream = await navigator.mediaDevices.getUserMedia({audio:true})
                    return true
                } catch (_) {
                    return false
                }
            }

            // Beendet Aufnahme und Verarbeitung
            async function stop() {
                if (audioStream) {
                    audioStream.getTracks().forEach(track => track.stop());
                }
            }

            // TODO: Visualisierung mit https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API/Visualizations_with_Web_Audio_API

        </script>
    </head>

    <body>

        <h1>Steuerung</h1>

        <button id="startStopButton">Start</button>

        <h1>Ausgabe</h1>

        <div id="outputDiv"></div>

    </body>

</html>